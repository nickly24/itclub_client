{"ast":null,"code":"var _jsxFileName = \"/Users/nickly/Desktop/\\u041F\\u0440\\u043E\\u0433\\u0430/project7/client/src/analytics/Analytics.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport YearSelector from './YearSelector';\nimport FilialSelector from './FilialSelector';\nimport AnalyticsTable from './AnalyticsTable';\nimport ProfitChart from './ProfitChart';\nimport { API_BASE_URL } from './Api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Analytics = () => {\n  _s();\n  const [selectedYear, setSelectedYear] = useState('');\n  const [selectedFilial, setSelectedFilial] = useState('all');\n  const [data, setData] = useState([]);\n  useEffect(() => {\n    if (selectedYear) {\n      fetchAllData();\n    }\n  }, [selectedYear, selectedFilial]);\n  const fetchAllData = async () => {\n    try {\n      const dataJan = await fetchData('01');\n      const dataFeb = await fetchData('02');\n      const dataMar = await fetchData('03');\n      const dataApr = await fetchData('04');\n      const dataMay = await fetchData('05');\n      const dataJun = await fetchData('06');\n      const dataJul = await fetchData('07');\n      const dataAug = await fetchData('08');\n      const dataSep = await fetchData('09');\n      const dataOct = await fetchData('10');\n      const dataNov = await fetchData('11');\n      const dataDec = await fetchData('12');\n      const allData = [...dataJan, ...dataFeb, ...dataMar, ...dataApr, ...dataMay, ...dataJun, ...dataJul, ...dataAug, ...dataSep, ...dataOct, ...dataNov, ...dataDec];\n      console.log('All Data:', allData);\n      const groupedData = groupDataByMonth(allData);\n      console.log('Grouped Data:', groupedData);\n      setData(groupedData);\n    } catch (error) {\n      console.error('Ошибка при получении данных аналитики:', error);\n    }\n  };\n  const fetchData = async month => {\n    try {\n      let response;\n      if (selectedFilial === 'all') {\n        response = await axios.get(`${API_BASE_URL}/dnevnik/${selectedYear}/${month}`);\n      } else {\n        response = await axios.get(`${API_BASE_URL}/analytics/${selectedYear}/${month}/${selectedFilial}`);\n      }\n      return response.data;\n    } catch (error) {\n      console.error(`Ошибка при получении данных за месяц ${month}:`, error);\n      return [];\n    }\n  };\n  const groupDataByMonth = data => {\n    const grouped = data.reduce((acc, record) => {\n      const month = record.date.substring(0, 7);\n      if (!acc[month]) {\n        acc[month] = [];\n      }\n      acc[month].push(record);\n      return acc;\n    }, {});\n    return Object.keys(grouped).map(month => {\n      const monthData = grouped[month];\n      const revenue = monthData.reduce((sum, record) => sum + record.number_of_children * record.price_per_session, 0);\n      const commission = revenue * 0.075;\n      const teacherPayments = monthData.reduce((sum, record) => {\n        const children = record.number_of_children;\n        let payment = 1000;\n        if (children > 4 && children < 10) {\n          payment += (children - 4) * 100;\n        } else if (children >= 10) {\n          payment = 2000;\n        }\n        return sum + payment;\n      }, 0);\n      const profit = revenue - commission - teacherPayments;\n      return {\n        month,\n        revenue,\n        commission,\n        teacherPayments,\n        profit,\n        records: monthData\n      };\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"analytics wrapper mt20\",\n    children: [/*#__PURE__*/_jsxDEV(YearSelector, {\n      selectedYear: selectedYear,\n      setSelectedYear: setSelectedYear\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(FilialSelector, {\n      selectedFilial: selectedFilial,\n      setSelectedFilial: setSelectedFilial\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AnalyticsTable, {\n      data: data\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProfitChart, {\n      data: data\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 5\n  }, this);\n};\n_s(Analytics, \"hwsQcoYxAWbK+1YBlfIw1OBnfl8=\");\n_c = Analytics;\nexport default Analytics;\nvar _c;\n$RefreshReg$(_c, \"Analytics\");","map":{"version":3,"names":["React","useState","useEffect","axios","YearSelector","FilialSelector","AnalyticsTable","ProfitChart","API_BASE_URL","jsxDEV","_jsxDEV","Analytics","_s","selectedYear","setSelectedYear","selectedFilial","setSelectedFilial","data","setData","fetchAllData","dataJan","fetchData","dataFeb","dataMar","dataApr","dataMay","dataJun","dataJul","dataAug","dataSep","dataOct","dataNov","dataDec","allData","console","log","groupedData","groupDataByMonth","error","month","response","get","grouped","reduce","acc","record","date","substring","push","Object","keys","map","monthData","revenue","sum","number_of_children","price_per_session","commission","teacherPayments","children","payment","profit","records","className","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/nickly/Desktop/Прога/project7/client/src/analytics/Analytics.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport YearSelector from './YearSelector';\nimport FilialSelector from './FilialSelector';\nimport AnalyticsTable from './AnalyticsTable';\nimport ProfitChart from './ProfitChart';\nimport { API_BASE_URL } from './Api';\n\nconst Analytics = () => {\n  const [selectedYear, setSelectedYear] = useState('');\n  const [selectedFilial, setSelectedFilial] = useState('all');\n  const [data, setData] = useState([]);\n\n  useEffect(() => {\n    if (selectedYear) {\n      fetchAllData();\n    }\n  }, [selectedYear, selectedFilial]);\n\n  const fetchAllData = async () => {\n    try {\n      const dataJan = await fetchData('01');\n      const dataFeb = await fetchData('02');\n      const dataMar = await fetchData('03');\n      const dataApr = await fetchData('04');\n      const dataMay = await fetchData('05');\n      const dataJun = await fetchData('06');\n      const dataJul = await fetchData('07');\n      const dataAug = await fetchData('08');\n      const dataSep = await fetchData('09');\n      const dataOct = await fetchData('10');\n      const dataNov = await fetchData('11');\n      const dataDec = await fetchData('12');\n\n      const allData = [\n        ...dataJan, \n        ...dataFeb, \n        ...dataMar, \n        ...dataApr, \n        ...dataMay, \n        ...dataJun, \n        ...dataJul, \n        ...dataAug, \n        ...dataSep, \n        ...dataOct, \n        ...dataNov, \n        ...dataDec\n      ];\n\n      console.log('All Data:', allData);\n      const groupedData = groupDataByMonth(allData);\n      console.log('Grouped Data:', groupedData);\n      setData(groupedData);\n    } catch (error) {\n      console.error('Ошибка при получении данных аналитики:', error);\n    }\n  };\n\n  const fetchData = async (month) => {\n    try {\n      let response;\n      if (selectedFilial === 'all') {\n        response = await axios.get(`${API_BASE_URL}/dnevnik/${selectedYear}/${month}`);\n      } else {\n        response = await axios.get(`${API_BASE_URL}/analytics/${selectedYear}/${month}/${selectedFilial}`);\n      }\n      return response.data;\n    } catch (error) {\n      console.error(`Ошибка при получении данных за месяц ${month}:`, error);\n      return [];\n    }\n  };\n\n  const groupDataByMonth = (data) => {\n    const grouped = data.reduce((acc, record) => {\n      const month = record.date.substring(0, 7);\n      if (!acc[month]) {\n        acc[month] = [];\n      }\n      acc[month].push(record);\n      return acc;\n    }, {});\n    return Object.keys(grouped).map(month => {\n      const monthData = grouped[month];\n      const revenue = monthData.reduce((sum, record) => sum + record.number_of_children * record.price_per_session, 0);\n      const commission = revenue * 0.075;\n      const teacherPayments = monthData.reduce((sum, record) => {\n        const children = record.number_of_children;\n        let payment = 1000;\n        if (children > 4 && children < 10) {\n          payment += (children - 4) * 100;\n        } else if (children >= 10) {\n          payment = 2000;\n        }\n        return sum + payment;\n      }, 0);\n      const profit = revenue - commission - teacherPayments;\n      \n      return {\n        month,\n        revenue,\n        commission,\n        teacherPayments,\n        profit,\n        records: monthData,\n      };\n    });\n  };\n\n  return (\n    <div className='analytics wrapper mt20'>\n      <YearSelector selectedYear={selectedYear} setSelectedYear={setSelectedYear} />\n      <FilialSelector selectedFilial={selectedFilial} setSelectedFilial={setSelectedFilial} />\n      <AnalyticsTable data={data} />\n      <ProfitChart data={data} />\n    </div>\n  );\n};\n\nexport default Analytics;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAOC,YAAY,MAAM,gBAAgB;AACzC,OAAOC,cAAc,MAAM,kBAAkB;AAC7C,OAAOC,cAAc,MAAM,kBAAkB;AAC7C,OAAOC,WAAW,MAAM,eAAe;AACvC,SAASC,YAAY,QAAQ,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAErC,MAAMC,SAAS,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACtB,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACc,cAAc,EAAEC,iBAAiB,CAAC,GAAGf,QAAQ,CAAC,KAAK,CAAC;EAC3D,MAAM,CAACgB,IAAI,EAAEC,OAAO,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EAEpCC,SAAS,CAAC,MAAM;IACd,IAAIW,YAAY,EAAE;MAChBM,YAAY,CAAC,CAAC;IAChB;EACF,CAAC,EAAE,CAACN,YAAY,EAAEE,cAAc,CAAC,CAAC;EAElC,MAAMI,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI;MACF,MAAMC,OAAO,GAAG,MAAMC,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMC,OAAO,GAAG,MAAMD,SAAS,CAAC,IAAI,CAAC;MACrC,MAAME,OAAO,GAAG,MAAMF,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMG,OAAO,GAAG,MAAMH,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMI,OAAO,GAAG,MAAMJ,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMK,OAAO,GAAG,MAAML,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMM,OAAO,GAAG,MAAMN,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMO,OAAO,GAAG,MAAMP,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMQ,OAAO,GAAG,MAAMR,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMS,OAAO,GAAG,MAAMT,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMU,OAAO,GAAG,MAAMV,SAAS,CAAC,IAAI,CAAC;MACrC,MAAMW,OAAO,GAAG,MAAMX,SAAS,CAAC,IAAI,CAAC;MAErC,MAAMY,OAAO,GAAG,CACd,GAAGb,OAAO,EACV,GAAGE,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,EACV,GAAGC,OAAO,CACX;MAEDE,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEF,OAAO,CAAC;MACjC,MAAMG,WAAW,GAAGC,gBAAgB,CAACJ,OAAO,CAAC;MAC7CC,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEC,WAAW,CAAC;MACzClB,OAAO,CAACkB,WAAW,CAAC;IACtB,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdJ,OAAO,CAACI,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;IAChE;EACF,CAAC;EAED,MAAMjB,SAAS,GAAG,MAAOkB,KAAK,IAAK;IACjC,IAAI;MACF,IAAIC,QAAQ;MACZ,IAAIzB,cAAc,KAAK,KAAK,EAAE;QAC5ByB,QAAQ,GAAG,MAAMrC,KAAK,CAACsC,GAAG,CAAE,GAAEjC,YAAa,YAAWK,YAAa,IAAG0B,KAAM,EAAC,CAAC;MAChF,CAAC,MAAM;QACLC,QAAQ,GAAG,MAAMrC,KAAK,CAACsC,GAAG,CAAE,GAAEjC,YAAa,cAAaK,YAAa,IAAG0B,KAAM,IAAGxB,cAAe,EAAC,CAAC;MACpG;MACA,OAAOyB,QAAQ,CAACvB,IAAI;IACtB,CAAC,CAAC,OAAOqB,KAAK,EAAE;MACdJ,OAAO,CAACI,KAAK,CAAE,wCAAuCC,KAAM,GAAE,EAAED,KAAK,CAAC;MACtE,OAAO,EAAE;IACX;EACF,CAAC;EAED,MAAMD,gBAAgB,GAAIpB,IAAI,IAAK;IACjC,MAAMyB,OAAO,GAAGzB,IAAI,CAAC0B,MAAM,CAAC,CAACC,GAAG,EAAEC,MAAM,KAAK;MAC3C,MAAMN,KAAK,GAAGM,MAAM,CAACC,IAAI,CAACC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;MACzC,IAAI,CAACH,GAAG,CAACL,KAAK,CAAC,EAAE;QACfK,GAAG,CAACL,KAAK,CAAC,GAAG,EAAE;MACjB;MACAK,GAAG,CAACL,KAAK,CAAC,CAACS,IAAI,CAACH,MAAM,CAAC;MACvB,OAAOD,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CAAC;IACN,OAAOK,MAAM,CAACC,IAAI,CAACR,OAAO,CAAC,CAACS,GAAG,CAACZ,KAAK,IAAI;MACvC,MAAMa,SAAS,GAAGV,OAAO,CAACH,KAAK,CAAC;MAChC,MAAMc,OAAO,GAAGD,SAAS,CAACT,MAAM,CAAC,CAACW,GAAG,EAAET,MAAM,KAAKS,GAAG,GAAGT,MAAM,CAACU,kBAAkB,GAAGV,MAAM,CAACW,iBAAiB,EAAE,CAAC,CAAC;MAChH,MAAMC,UAAU,GAAGJ,OAAO,GAAG,KAAK;MAClC,MAAMK,eAAe,GAAGN,SAAS,CAACT,MAAM,CAAC,CAACW,GAAG,EAAET,MAAM,KAAK;QACxD,MAAMc,QAAQ,GAAGd,MAAM,CAACU,kBAAkB;QAC1C,IAAIK,OAAO,GAAG,IAAI;QAClB,IAAID,QAAQ,GAAG,CAAC,IAAIA,QAAQ,GAAG,EAAE,EAAE;UACjCC,OAAO,IAAI,CAACD,QAAQ,GAAG,CAAC,IAAI,GAAG;QACjC,CAAC,MAAM,IAAIA,QAAQ,IAAI,EAAE,EAAE;UACzBC,OAAO,GAAG,IAAI;QAChB;QACA,OAAON,GAAG,GAAGM,OAAO;MACtB,CAAC,EAAE,CAAC,CAAC;MACL,MAAMC,MAAM,GAAGR,OAAO,GAAGI,UAAU,GAAGC,eAAe;MAErD,OAAO;QACLnB,KAAK;QACLc,OAAO;QACPI,UAAU;QACVC,eAAe;QACfG,MAAM;QACNC,OAAO,EAAEV;MACX,CAAC;IACH,CAAC,CAAC;EACJ,CAAC;EAED,oBACE1C,OAAA;IAAKqD,SAAS,EAAC,wBAAwB;IAAAJ,QAAA,gBACrCjD,OAAA,CAACN,YAAY;MAACS,YAAY,EAAEA,YAAa;MAACC,eAAe,EAAEA;IAAgB;MAAAkD,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eAC9EzD,OAAA,CAACL,cAAc;MAACU,cAAc,EAAEA,cAAe;MAACC,iBAAiB,EAAEA;IAAkB;MAAAgD,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACxFzD,OAAA,CAACJ,cAAc;MAACW,IAAI,EAAEA;IAAK;MAAA+C,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eAC9BzD,OAAA,CAACH,WAAW;MAACU,IAAI,EAAEA;IAAK;MAAA+C,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACxB,CAAC;AAEV,CAAC;AAACvD,EAAA,CA7GID,SAAS;AAAAyD,EAAA,GAATzD,SAAS;AA+Gf,eAAeA,SAAS;AAAC,IAAAyD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}